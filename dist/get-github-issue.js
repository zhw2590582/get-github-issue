/*!
 * get-github-issue.js v1.0.3
 * Github: https://github.com/zhw2590582/get-github-issue#readme
 * (c) 2017-2019 Harvey Zack
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self)["get-github-issue"]={})}(this,function(e){"use strict";var o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e};function i(t){return Object.keys(t).map(function(e){return"".concat(e,"=").concat(encodeURIComponent(t[e]||""))}).join("&")}var n=function(){function n(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,n),this.cache=new Map,this.option=Object.assign({},n.DEFAULTS,e),["owner","repo","clientID","clientSecret"].forEach(function(e){if(!t.option[e])throw new TypeError("[option.".concat(e,"] can not be empty."))})}return t(n,[{key:"getUrl",value:function(e){var t="https://api.github.com/repos/".concat(this.option.owner,"/").concat(this.option.repo,"/issues"),n={t:Date.now(),client_id:this.option.clientID,client_secret:this.option.clientSecret};return"number"==typeof e?"".concat(t,"/").concat(e,"?").concat(i(n)):"".concat(t,"?").concat(i(Object.assign(n,e)))}},{key:"getRequest",value:function(e){var t=this;return this.option.loadFn(!0),fetch(e,{headers:{"Content-Type":"application/json",Accept:"application/vnd.github.v3.".concat(this.option.requestType,"+json")}}).then(function(e){return t.option.loadFn(!1),404===e.status?Promise.reject(new Error("Unauthorized")):e.json()}).catch(function(e){throw t.option.loadFn(!1),e})}},{key:"format",value:function(e){var t=this,n={title:e.title,html:e.body_html,created_at:e.created_at,updated_at:e.updated_at,comments:e.comments,tags:e.labels.filter(function(e){return!Object.values(t.option.labels).includes(e.name)}).map(function(e){return e.name}),url:e.url,id:e.number,excerpt:"",poster:""};try{n.excerpt=function(e,t){return e.length>t?"".concat(e.slice(0,3<t?t-3:t),"..."):e}(e.body_text.replace(/[\r\n]/g,""),this.option.excerpt)}catch(e){n.excerpt=""}try{n.poster=/src=[\'\"]?([^\'\"]*)[\'\"]?/i.exec(/<img.*?(?:>|\/>)/.exec(e.body_html)[0])[1]}catch(e){n.poster=""}return n}},{key:"byPage",value:function(e){var n=this,t=e.page,o=void 0===t?1:t,c=e.labels,i=void 0===c?"":c,r=e.type,a=void 0===r?this.option.labels.post:r,s="page=".concat(o,"&labels=").concat(i,"&type=").concat(a);if(this.option.cache&&this.cache.has(s))return Promise.resolve(this.cache.get(s));var u=Object.values(this.option.labels);if(!u.includes(a))throw new TypeError("[type] only accept: ".concat(u.join("|"),"."));var p=this.getUrl({page:o,per_page:this.option.pageSize,labels:"".concat(a,",").concat(i)});return this.getRequest(p).then(function(e){var t=e.map(function(e){return n.option.cache&&n.cache.set("id=".concat(e.number),e),n.format(e)});return n.option.cache&&n.cache.set(s,t),t})}},{key:"byId",value:function(e){var n=this,o="id=".concat(e);if(this.option.cache&&this.cache.has(o))return Promise.resolve(this.cache.get(o));var t=this.getUrl(Number(e));return this.getRequest(t).then(function(e){var t=n.format(e);return n.option.cache&&n.cache.set(o,t),t})}}],[{key:"DEFAULTS",get:function(){return{owner:"",repo:"",clientID:"",clientSecret:"",cache:!0,excerpt:120,pageSize:10,requestType:"full",loadFn:function(e){return e},labels:{post:"POST",page:"PAGE",config:"CONFIG"}}}}]),n}();window.GetGithubIssue=n,e.default=n,Object.defineProperty(e,"__esModule",{value:!0})});
